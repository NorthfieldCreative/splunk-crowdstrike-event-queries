https://www.reddit.com/r/crowdstrike/comments/ooo6kk/20210721_cool_query_friday_finding_and_mitigating/

event_platform=win (event_simpleName=ProcessRollup2 OR event_simpleName=SyntheticProcessRollup2 OR event_simpleName=
ServiceStarted AND FileName=vssvc.exe) OR event_simpleName=OsVersionInfo
| lookup local=true aid_master aid OUTPUT AgentVersion, MachineDomain, OU, SiteName, Version, ProductType
| eval FileName=lower(FileName)
| stats dc(event_simpleName) as eventCount latest(BuildNumber_decimal) as buildNumber latest(SubBuildNumber_decimal) as subBuildNumber latest(ProductName) as productName values(FileName) as vssProcessRunning by aid, ComputerName, AgentVersion, MachineDomain, OU, SiteName, ProductType
| where buildNumber>=17763
| search ProductType=1
| where isnotnull(vssProcessRunning)
| table aid ComputerName MachineDomain OU SiteName AgentVersion productName buildNumber, subBuildNumber, vssProcessRunning
| rename ComputerName as hostName, MachineDomain as machineDomain, SiteName as siteName, AgentVersion as falconVersion



### Using PowerShell to Identify Impacted Systems

### The most reliable way to find impacted systems is to run the following command natively on the host in PowerShell or via RTR:

icacls $env:windir\System32\config\SAM

The output will looks something like this:

### C:\Windows\System32\config\SAM BUILTIN\Administrators:(I)(F)
#                               NT AUTHORITY\SYSTEM:(I)(F)
#                               BUILTIN\Users:(I)(RX)
#                               APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX)
#                               APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(I)(RX)
#
# Successfully processed 1 files; Failed processing 0 files
